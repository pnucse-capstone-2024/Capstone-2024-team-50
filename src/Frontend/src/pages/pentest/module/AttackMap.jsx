import * as React from 'react';
import {
    Table, TableBody, TableCell, TableContainer, TableHead, TableRow, Paper, Typography, Tooltip, Box, Card, CardContent
} from '@mui/material';
import { fetchGetAttackTactics, fetchGetAttackTechniques } from '../../../services/AttackMapServices';


export default function AttackMap({tactics, groupedTechniques}) {

    return (
        <TableContainer >
            <Table sx={{ minWidth: 650 }} aria-label="simple table">
                <TableHead>
                    <TableRow>
                        {tactics.map((tactic) => (
                            <TableCell key={tactic.taid} sx={{ textAlign: 'center', borderBottom: '2px solid #ddd' }}>
                                <Typography variant='h6' sx={{ fontWeight: 'bold' }}>
                                    {tactic.name}
                                </Typography>
                            </TableCell>
                        ))}
                    </TableRow>
                </TableHead>
                <TableBody >
                    <TableRow>
                        {tactics.map((tactic) => (
                            <TableCell key={tactic.taid} sx={{ padding: 2, verticalAlign:'top', borderRight: tactic.name == 'Impact' ? '' : '2px solid #ddd', borderBottom:'none' }}>
                                {groupedTechniques[tactic.taid] && groupedTechniques[tactic.taid].length > 0 ? (
                                    <Box>
                                        {groupedTechniques[tactic.taid].map((technique) => (
                                            <Tooltip
                                                key={technique.tid}
                                                title={
                                                    <Box sx={{ p: 1 }}>
                                                        <Typography variant='subtitle2' sx={{ fontWeight: 'bold' }}>
                                                            {technique.tid}
                                                        </Typography>
                                                        <Typography>
                                                            {technique.name}
                                                        </Typography>
                                                    </Box>
                                                }
                                                arrow
                                                placement='right'
                                            >
                                                <Box sx={{ mb: 1, cursor: 'pointer' }}>
                                                    <Card sx={{ boxShadow: 1, borderRadius: 2, backgroundColor: technique.status === 'init' ? '#fff' : technique.status === 'loading' ? '#0000FF30' : technique.status === 'success' ? '#00FF0040' : '#FF000040' }}>
                                                        <CardContent>
                                                            <Typography variant='body2'>
                                                                {technique.name}
                                                            </Typography>
                                                        </CardContent>
                                                    </Card>
                                                </Box>
                                            </Tooltip>
                                        ))}
                                    </Box>
                                ) : (
                                    <Typography variant='body2' align='center'>
                                        No techniques available
                                    </Typography>
                                )}
                            </TableCell>
                        ))}
                    </TableRow>
                </TableBody>
            </Table>
        </TableContainer>
    );
}
